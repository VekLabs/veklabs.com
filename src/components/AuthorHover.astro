---
import type { Team } from '@/payload-types'
import type { Populated } from '@/utils/typeChecks'
import { capitalize, uniqueId } from 'lodash-es'
import Image from './Image'
import { PhLinkedinLogo, PhXLogo } from 'phosphor-icons-astro'

type Props = {
  author: Populated<Team>
  id: string | number
  includeChannels?: boolean
}

const { author, id, includeChannels = true } = Astro.props

const channelLogos = {
  Twitter: PhXLogo,
  LinkedIn: PhLinkedinLogo,
}

const anchorName = `--${id}`
---

<div class="group">
  <span class="cursor-help" style={`anchor-name: ${anchorName};`}>
    {capitalize(author.name)}
  </span>

  <div
    class="fixed z-20 -translate-x-1/2 translate-y-4 scale-90 rounded-lg bg-gray-900 p-6 opacity-0 transition-all transition-discrete delay-500  group-hover:flex group-hover:scale-100 group-hover:opacity-100 starting:scale-90 starting:opacity-0"
    style={`position-anchor: ${anchorName}; top: anchor(top); left: anchor(left);`}
  >
    <div class="flex items-center gap-4">
      <Image
        media={author.image}
        alt={author.name}
        width={40}
        height={40}
        className="h-10 w-10 rounded-full border border-white/10 object-cover"
      />
      <div class="flex flex-col">
        <span class="text-sm text-white">{capitalize(author.name)}</span>
        <span class="text-xs text-gray-400">{author.title}</span>
      </div>
      {
        includeChannels &&
          author.channel.length > 0 &&
          author.channel.map((channel) => (
            <a
              href={channel.url}
              target="_blank"
              rel="noopener noreferrer"
              class="ml-auto text-sm text-gray-400 hover:text-white"
            >
              {channelLogos[channel.name] && (
                <channelLogos[channel.name] weight="bold" size={20} />
              )}
            </a>
          ))
      }
    </div>
  </div>
</div>
