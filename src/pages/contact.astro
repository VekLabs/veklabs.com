---
import Image from '@/components/Image'
import { getPayload } from '@/payload'
import type { Service, SiteSetting } from '@/payload-types'
import type { Populated } from '@/utils/typeChecks'
import { PhChat, PhMapPinArea, PhPhone } from 'phosphor-icons-astro'
import ContactForm from '../components/ContactForm.tsx'
import ContactPart from '../components/ContactPart.astro'
import Layout from '../layouts/Layout.astro'

const payload = await getPayload()

const services = (await payload.find({ collection: 'services', limit: 100 }))
  .docs as Populated<Service>[]

const siteSettings = (await payload.findGlobal({
  slug: 'site-settings',
})) as Populated<SiteSetting>
---

<Layout title="Contact">
  <section class="w-container mx-auto py-14">
    <div class="flex flex-col lg:flex-row">
      <div class="flex basis-2/5 flex-col gap-8">
        <div
          class="flex flex-wrap gap-8 px-8 pb-12 lg:min-h-[60vh] lg:flex-col lg:flex-nowrap lg:gap-20"
        >
          <div class="mb-auto hidden lg:block"></div>
          <ContactPart
            title="Chat to us"
            description="Our team is here to help."
            link={{ href: 'mailto:info@veklabs.com', text: 'info@veklabs.com' }}
          >
            <PhChat size="20" />
          </ContactPart>
          <ContactPart
            title="Send Mail to Us"
            description="We love letters."
            link={{
              href: 'map:PO Box 46068 Inglewood, Calgary, AB T2G5H7',
              text: 'PO Box 46068 Inglewood, Calgary, AB T2G5H7',
            }}
          >
            <PhMapPinArea size="20" />
          </ContactPart>
          <ContactPart
            title="Call us"
            description="Mon-Sat from 8am to 6pm."
            link={{ href: 'tel:+14036901291', text: '+1 (403) 690-1291' }}
          >
            <PhPhone size="20" />
          </ContactPart>
          <div class="mt-auto hidden lg:block"></div>
        </div>

        <div
          class="mt-8 mb-8 hidden flex-wrap gap-3 px-8 text-right md:inline-flex lg:mt-auto lg:gap-4"
        >
          {
            siteSettings.social?.map(async ({ url, name, icon }) => {
              return (
                <a
                  href={url}
                  target="_blank"
                  class="flex aspect-square items-center justify-center rounded-sm border border-white/30 p-2 font-semibold text-white transition hover:bg-white/10"
                  title={name}
                >
                  <Image media={icon} className="h-6 lg:h-4" />
                </a>
              )
            })
          }
        </div>
      </div>
      <div class="basis-3/5">
        <ContactForm services={services} client:load />
      </div>
    </div>
  </section>
</Layout>
